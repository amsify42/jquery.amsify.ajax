// Amsify42 Ajax 1.0.0
// http://www.amsify42.com
!function(t,a,e){function s(t){return"bootstrap"==t?'<span class="fa fa-times"></span>':"<b>X</b>"}function i(t,e,s){var i=t;return a.each(e,function(t,a){var e=new RegExp("{"+t+"}","gi");i=i.replace(e,a)}),i}function l(t){var e={};return a(t).each(function(t,s){a(s).attr("name")&&(e[a(s).attr("name")]=a(s).val())}),e}function n(t,s){var i=a(t).next(S).find("li"),l=!1;s!==e&&"up"==s&&(i=i.get().reverse()),a(i).each(function(t,e){if(l)return a(e).addClass("active"),!1;if(a(e).hasClass("active")){if(t==i.length-1)return!1;a(e).removeClass("active"),l=!0}})}function o(t,e,s,i){var l=r(t,i);a(s).next(e).length?a(s).next(e).html(l).show():AmsifyHelper.detectIE()?(a(s).parent().append('<ul tabindex="1" style="width:'+a(s).css("width")+';" class="'+e.substring(1)+'"></ul>'),a(e).html(l)):a(s).after('<ul tabindex="1" style="width:'+a(s).css("width")+';" class="'+e.substring(1)+'">'+l+"</ul>");var n=!1;a(a(e).find("li")).each(function(t,e){a(e).hasClass("active")&&(n=!0)}),n||a(e).find("li:first").addClass("active").focus()}function r(t,s){if(s!==e&&"html"==s)return i;var i="";return t.length>0&&a.each(t,function(t,a){i+='<li><a href="#" data-value="'+a+'">'+a+"</li>"}),i}function c(t){t!==e&&(t.type!==e&&(f=t.type),t.toggleSelector!==e&&(d=t.toggleSelector),t.toggleClass!==e&&(h=t.toggleClass),t.toggleHTML!==e&&(g=t.toggleHTML),t.changeField!==e&&(u=t.changeField),t.loadForm!==e&&(y=t.loadForm),t.loadSubmit!==e&&(p=t.loadSubmit),t.loadContainer!==e&&(v=t.loadContainer),t.loadMore!==e&&(A=t.loadMore),t.loaderPath!==e&&(C=t.loaderPath),t.ajaxSortClass!==e&&(j=t.ajaxSortClass),t.itemClass!==e&&(k=t.itemClass),t.itemAddClass!==e&&(D=t.itemAddClass),t.itemRemoveClass!==e&&(I=t.itemRemoveClass))}var m=!0,f="",d=".amsify-ajax-toggle",h=["btn-success","btn-danger"],g=['<span class="fa fa-check"></span>','<span class="fa fa-times"></span>'],u=".amsify-ajax-change",y=".amsify-ajax-load-form",p=".amsify-ajax-load-submit",v=".amsify-ajax-load-container",A=".amsify-ajax-load-more",C="images/loader.gif",x="images/loader-small.gif",j=".amsify-ajax-sort",b=".amsify-ajax-suggestion",H="search.php",S=".amsify-ajax-suggestions-container",k=".amsify-ajax-item",D=".amsify-ajax-item-add",I=".amsify-ajax-item-remove",F=".amsify-ajax-list",w=".amsify-ajax-list-item",L=".amsify-ajax-list-field",T="",M=".amsify-ajax-list-remove";a.fn.extend({amsifyToggle:function(a,s){var i=m;if(a!==e)s!==e?a.toggleSelector=s:(a.toggleSelector=this,i=!1);else{var a={toggleSelector:this};i=!1}t.setToggle(a,i)},amsifyLoadData:function(a){if(a!==e)a.loadForm=this;else var a={loadForm:this};t.setLoadData(a)},amsifyDynamicItems:function(a){if(a!==e)a.itemClass=this;else var a={itemClass:this};t.setDynamicItems(a)},amsifyItemsList:function(a){if(a!==e)a.listItemField=this;else var a={listItemField:this};t.setItemsList(a)},amsifySuggestData:function(a){if(a!==e)a.suggestField=this;else var a={suggestField:this};t.setSuggestData(a)},amsifyOnChange:function(a){if(a!==e)a.changeField=this;else var a={changeField:this};t.setOnChange(a)}}),t.init=function(a){c(a);var e=new t.Ajax;e.set()},t.set=function(a){var e=new t.Ajax;e.set(a)},t.Ajax=function(){t.Ajax.prototype.set=function(a){a!==e?(t.setToggle(a),t.setOnChange(a),t.setLoadData(a),t.setSuggestData(a),t.setDynamicItems(a)):(t.setToggle(),t.setOnChange(),t.setLoadData(),t.setSuggestData(),t.setDynamicItems()),AmsifyHelper.bodyLoaderIEfix()}},t.setToggle=function(t,s){var i=m,l=d,n=h,o=g;s!==e&&(i=s),t!==e&&(t.toggleSelector!==e&&(l=t.toggleSelector),t.toggleClass!==e&&(n=t.toggleClass),t.toggleHTML!==e&&(o=t.toggleHTML));var r=function(){var s=a(this),i=a(this).data("id"),l=a(this).data("val"),r=a(this).data("method");a(this).data("class")!==e&&(n=a(this).data("class").split(":")),a(this).data("html")!==e&&(o=a(this).data("html").split(":")),0==l?a(this).removeClass(n[1]).addClass(n[0]).data("val",1).empty().html(o[0]):a(this).removeClass(n[0]).addClass(n[1]).data("val",0).empty().html(o[1]);var c={},m={id:i,val:l,_token:AmsifyHelper.getToken()};c.complete=function(){AmsifyHelper.callback(t,"afterToggle",s,"after-toggle")},AmsifyHelper.callAjax(r,m,c)};AmsifyHelper.setEvent(i,"click",l,r)},t.setLoadData=function(s){var i=f,l=y,n=p,o=v,r=A,c=C,m=j;s!==e&&(s.type!==e&&(i=s.type),s.loadForm!==e&&(l=s.loadForm),s.loadSubmit!==e&&(n=s.loadSubmit),s.loadContainer!==e&&(o=s.loadContainer),s.loadMore!==e&&(r=s.loadMore),s.loaderPath!==e&&(c=s.loaderPath),s.ajaxSortClass!==e&&(m=s.ajaxSortClass)),a(l).each(function(e,l){a(l).submit(function(t){t.preventDefault()});var f=a(this).find(":input"),d=[],h=(a(this).attr("data-action"),"");a.each(f,function(t,e){a(e).hasClass(n.substring(1))?h=n:d.push(a(e).attr("name"))}),""==h?(d=AmsifyHelper.distinctArray(d),a.each(d,function(e,i){a(document).on("change",AmsifyHelper.fieldByName(i),function(){t.callAjax(l,o,r,c,"load",s)})})):a(document).on("click",h,function(){AmsifyHelper.setDefaultSortIcon(m,i),t.callAjax(l,o,r,c,"load",s)}),a(m).length&&AmsifyHelper.setDefaultSortIcon(m,i),a(document).on("click",r,function(e){if(e.preventDefault(),a(this).addClass("loading-state"),a(this).hasClass(m.substring(1))){if(!a(this).hasClass("amsify-sort-active")){var n=a(this).html(),r=AmsifyHelper.getSortIcon(n,i),f=r.basic,d=r.insertHtml;a(this).attr("data-page")||a(this).attr("data-page","1"),"bootstrap"==i?(a(m).find(".fa").remove(),a(this).find(".fa").remove()):(a(m).find(".sort-icon").remove(),a(this).find(".sort-icon").remove()),a(m).not(this).append(f);var h="asc";"desc"==r.sort_type&&(h="desc"),a(this).attr("data-type",h),a(this).append(d)}}else AmsifyHelper.setDefaultSortIcon(m,i);t.callAjax(l,o,this,c,"append",s)}),a(r).hasClass("amsify-ajax-paginate")||t.setOnScrollAjax(o,r)})},t.setOnScrollAjax=function(t,e){a(t).on("scroll mousewheel DOMMouseScroll",function(t){a(e).length&&!a(e).hasClass("loading-state")&&a(this).scrollTop()+a(this).innerHeight()>=a(this)[0].scrollHeight&&a(e).click()})},t.callAjax=function(t,s,i,l,n,o){var r="",c={};if(a(i).attr("href"))r=a(i).attr("href");else{var m=AmsifyHelper.getFormData(a(t),!0),f=AmsifyHelper.getActionURL(a(t).attr("data-action"));if(a(i).hasClass("amsify-ajax-paginate")&&a(i).attr("data-page")){var d=j;o.ajaxSortClass!==e&&(d=o.ajaxSortClass),"load"==n||"1"==a(t).attr("search-running")||a(i).hasClass(d.substring(1))?(a(i).attr("data-column")&&(m=m+"&column="+a(i).attr("data-column")),a(i).attr("data-type")&&(m=m+"&type="+a(i).attr("data-type")),m=m+"&page="+a(i).attr("data-page")):m="page="+a(i).attr("data-page")}r=f+"?"+m}c.beforeSend=function(){AmsifyHelper.showURL(r),"append"!=n||a(i).hasClass("amsify-ajax-paginate")?a(".section-body-loader").show():a(i).append('<img src="'+AmsifyHelper.getActionURL(l)+'"/>')},c.afterSuccess=function(t){"append"==n?t.links!==e?(a("#pagination-area").html(t.links),a(s).html(t.html)):(a(i).remove(),a(s).append(t.html)):(a(s).html(t.html),t.links!==e&&a("#pagination-area").html(t.links))},c.complete=function(){AmsifyHelper.callback(o,"afterLoad"),a(".section-body-loader").hide(),a(i).removeClass("loading-state"),"load"==n&&a(i).hasClass("amsify-ajax-paginate")?a(t).attr("search-running","1"):"1"!=a(t).attr("search-running")&&a(t).attr("search-running","0")},AmsifyHelper.callAjax(r,{},c,"GET")},t.setOnChange=function(s){var i=u;s!==e&&s.changeField!==e&&(i=s.changeField),a(i).each(function(e,i){a(i).on("change",function(){AmsifyHelper.callback(s,"beforeChange",this,"after-change"),""!=a.trim(a(this).val())&&t.callAjaxForChange(this,s)})})},t.callAjaxForChange=function(t,s){var i=a(t).attr("amsify-ajax-action"),l={value:a(t).val(),_token:AmsifyHelper.getToken()},n={},o=a(t).attr("amsify-ajax-change"),r=x;s!==e&&(s.extraParams!==e&&(l=a.extend({},l,extraParams)),s.loaderPath!==e&&(r=s.loaderPath)),n.beforeSend=function(){a(o).before('<img class="on-change-loader" src="'+AmsifyHelper.getActionURL(r)+'"/>')},n.afterSuccess=function(t){a(o).html(t.html)},n.complete=function(){a(".on-change-loader").hide(),AmsifyHelper.callback(s,"afterChange",t,"after-change")},AmsifyHelper.callAjax(i,l,n)},t.setDynamicItems=function(t){var i=f,l=k,n=D,o=I;t!==e&&(t.type!==e&&(i=t.type),t.itemClass!==e&&(l=t.itemClass),t.itemAddClass!==e&&(n=t.itemAddClass),t.itemRemoveClass!==e&&(o=t.itemRemoveClass)),a(document).on("click",n,function(){if(a(l).attr("amsify-item-limit")){var e=parseInt(a(l).attr("amsify-item-limit"));if(a(l).length>=e){var r="You can not add more than "+e+" items";a(l).attr("amsify-limit-message")&&(r=a(l).attr("amsify-limit-message"));var c="Message";return a(l).attr("amsify-message-title")&&(c=a(l).attr("amsify-message-title")),AmsifyModal.showMessage(r,i,c),!1}}AmsifyHelper.callback(t,"beforeAdd",this,"before-add"),$item=a(this).closest(l),$item.length&&("object"==typeof l?$html=$item.clone().insertAfter(l).attr("amsify-close-item","1"):$html=$item.clone().insertAfter(l+":last"),$html.find(n).removeClass(n.substring(1)).addClass(o.substring(1)).html(s(i)),$html.find("input").val("")),AmsifyHelper.callback(t,"afterAdd",this,"after-add")}),a(document).on("click",o,function(){"object"==typeof l?a(this).closest("[amsify-close-item=1]").remove():a(this).closest(l).remove(),AmsifyHelper.callback(t,"afterDelete",this,"after-delete")})},t.setItemsList=function(t){var s=f,n=F,o=w,r=L,c=T,m=M,d="",h="";if(t!==e&&(t.type!==e&&(s=t.type),t.listClass!==e&&(n=t.listClass),t.listItemClass!==e&&(o=t.listItemClass),t.listItemField!==e&&(r=t.listItemField),t.listItemHTML!==e&&(c=t.listItemHTML),t.listItemRemove!==e&&(m=t.listItemRemove),t.ajaxAddAction!==e&&(d=t.ajaxAddAction),t.ajaxRemoveAction!==e&&(h=t.ajaxRemoveAction)),a(r).keyup(function(e){if(13==e.which){var s,m=a(this).closest(n).find(r),f=l(m),h=i(c,f,o);s=a(this).closest(".amsify-ajax-list-last").length?a(h).insertBefore(a(this).closest(".amsify-ajax-list-last")):a(h).appendTo(a(this).closest(n)),a(this).closest(n).find(r).not("input[type='hidden']").val(""),t.afterSuccess=function(e){a(s).attr("item-id",e.item_id),t.afterAdd&&"function"==typeof t.afterAdd&&t.afterAdd(s,e)},d&&AmsifyHelper.callAjax(d,f,t)}}),a(document).on("click",m,function(){var e=a(this).closest(o).attr("item-id"),s={id:e};t.afterDelete&&"function"==typeof t.afterDelete&&t.afterDelete($item),a(this).closest(o).remove(),h&&AmsifyHelper.callAjax(h,s,t)}),a(r).closest(n).is("[amsify-list-draggable]")){var g=a(r).closest(n),u=a(r).closest(n).attr("amsify-list-draggable"),y=a(r).closest(n).find(r),p=l(y);AmsifyHelper.setDraggableSort(g,u,"item-id",p)}},t.setSuggestData=function(s){var i=b,l=H;s!==e&&(s.suggestField!==e&&(i=s.suggestField),s.suggestAction!==e&&(l=s.suggestAction));var o=a(i).parent().closest("form");a(document).on("submit",o,function(t){t.stopImmediatePropagation();var s=a(this).find("ul.amsify-ajax-suggestions-container li"),l=a(this).find("ul.amsify-ajax-suggestions-container").css("display");a(s).each(function(t,e){if(a(e).hasClass("active")){var s=a(e).find("a").attr("data-value");a(i).attr("data-value",s),a(i).val(s),a(S).hide()}}),l!==e&&"block"==l&&t.preventDefault()}),a.fn.delayKeyup=function(t,e){return this.each(function(){var s=0,i=this;a(this).keyup(function(a){clearTimeout(s),s=setTimeout(function(){t.call(i,a)},e)})})},a(i).delayKeyup(function(i){a(this).attr("method-action")&&(l=a(this).attr("method-action"));var n=a(this).attr("data-value"),o=a(this).hasClass("amsify-wait"),r=a.trim(a(this).val()),c=!1;(n===e||n!=r)&&""!=r&&(c=!0),!o&&c&&(a(this).addClass("amsify-wait"),a(this).attr("data-value",a(this).val()),t.callAjaxForSuggestions(this,l,s))},500),a(document).on("keydown",i,function(t){var e=a(this).next(S);e.length&&(40==t.keyCode||38==t.keyCode)&&(40==t.keyCode&&n(this),38==t.keyCode&&n(this,"up"))}),a(document).on("click",S+" li",function(t){t.stopImmediatePropagation(),a(i).attr("data-value",a(this).find("a").attr("data-value")),a(i).val(a(this).find("a").attr("data-value")),a(S).hide()}),a(document).on({mouseenter:function(){a(S+" li").removeClass("active"),a(this).addClass("active")},mouseleave:function(){}},S+" li")},t.callAjaxForSuggestions=function(t,e,s){var i={},l={term:a(t).val(),_token:AmsifyHelper.getToken()};i.afterSuccess=function(a){var e="";a.html===!0&&(e="html"),o(a.suggestions,S,t,e)},i.complete=function(){a(t).removeClass("amsify-wait"),AmsifyHelper.callback(s,"afterSuggestions")},AmsifyHelper.callAjax(e,l,i)}}(window.AmsifyAjax=window.AmsifyAjax||{},jQuery);